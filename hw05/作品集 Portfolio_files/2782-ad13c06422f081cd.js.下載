"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2782],{42447:function(e,t,s){s.d(t,{Aw:function(){return Meter75},X7:function(){return MeterExclamation},Xt:function(){return Meter50},eA:function(){return MeterNone},fy:function(){return Meter25},i4:function(){return Meter100}});var n=s(85893);let Meter100=e=>{let{title:t,...s}=e;return(0,n.jsxs)("svg",{width:"32",height:"16",viewBox:"0 0 32 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s,children:[t&&(0,n.jsx)("title",{children:t}),(0,n.jsx)("rect",{x:"3",y:"3",width:"26",height:"10",rx:"2",fill:"#C4C4C4"}),(0,n.jsx)("rect",{x:"1",y:"1",width:"30",height:"14",rx:"4",stroke:"#C4C4C4",strokeWidth:"2"})]})},Meter75=e=>{let{title:t,...s}=e;return(0,n.jsxs)("svg",{width:"32",height:"16",viewBox:"0 0 32 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s,children:[t&&(0,n.jsx)("title",{children:t}),(0,n.jsx)("path",{d:"M3 5C3 3.89543 3.89543 3 5 3H23V13H5C3.89543 13 3 12.1046 3 11V5Z",fill:"#C4C4C4"}),(0,n.jsx)("rect",{x:"1",y:"1",width:"30",height:"14",rx:"4",stroke:"#C4C4C4",strokeWidth:"2"})]})},Meter50=e=>{let{title:t,...s}=e;return(0,n.jsxs)("svg",{width:"32",height:"16",viewBox:"0 0 32 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s,children:[t&&(0,n.jsx)("title",{children:t}),(0,n.jsx)("path",{d:"M3 5C3 3.89543 3.89543 3 5 3H16V13H5C3.89543 13 3 12.1046 3 11V5Z",fill:"#C4C4C4"}),(0,n.jsx)("rect",{x:"1",y:"1",width:"30",height:"14",rx:"4",stroke:"#C4C4C4",strokeWidth:"2"})]})},Meter25=e=>{let{title:t,...s}=e;return(0,n.jsxs)("svg",{width:"32",height:"16",viewBox:"0 0 32 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s,children:[t&&(0,n.jsx)("title",{children:t}),(0,n.jsx)("path",{d:"M3 5C3 3.89543 3.89543 3 5 3H9V13H5C3.89543 13 3 12.1046 3 11V5Z",fill:"#D39817"}),(0,n.jsx)("rect",{x:"1",y:"1",width:"30",height:"14",rx:"4",stroke:"#D39817",strokeWidth:"2"})]})},MeterExclamation=e=>{let{title:t,...s}=e;return(0,n.jsxs)("svg",{width:"40",height:"24",viewBox:"0 0 40 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s,children:[t&&(0,n.jsx)("title",{children:t}),(0,n.jsx)("path",{d:"M18.3477 7.13574H20.9727L20.7539 13.7666H18.5664L18.3477 7.13574ZM19.6602 17.2393C18.7783 17.2393 18.2656 16.7812 18.2656 15.9951C18.2656 15.2021 18.7783 14.7441 19.6602 14.7441C20.542 14.7441 21.0615 15.2021 21.0615 15.9951C21.0615 16.7812 20.542 17.2393 19.6602 17.2393Z",fill:"#BD860D"}),(0,n.jsx)("rect",{x:"5",y:"5",width:"30",height:"14",rx:"4",stroke:"#D39817",strokeWidth:"2"})]})},MeterNone=e=>{let{title:t,...s}=e;return(0,n.jsxs)("svg",{width:"32",height:"16",viewBox:"0 0 32 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s,children:[t&&(0,n.jsx)("title",{children:t}),(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.1459 0H5C2.23858 0 0 2.23858 0 5V11C0 13.7614 2.23858 16 5 16H8.17124C8.21217 15.8847 8.2606 15.7706 8.31672 15.6584L9.1459 14H5C3.34315 14 2 12.6569 2 11V5C2 3.34315 3.34315 2 5 2H15.1459L16.1459 0ZM15.8541 14H27C28.6569 14 30 12.6569 30 11V5C30 3.34315 28.6569 2 27 2H21.8541L22.6833 0.341641C22.7394 0.229397 22.7878 0.115316 22.8288 0H27C29.7614 0 32 2.23858 32 5V11C32 13.7614 29.7614 16 27 16H14.8541L15.8541 14Z",fill:"#D39817"}),(0,n.jsx)("path",{d:"M12 15L19 1",stroke:"#D39817",strokeWidth:"2",strokeLinecap:"round"})]})}},17238:function(e,t,s){s.d(t,{X:function(){return Pane},h:function(){return PaneHeader}});var n=s(85893),r=s(94184),i=s.n(r);let PaneHeader=e=>{let{children:t,className:s="",...r}=e;return(0,n.jsx)("div",{className:i()("flex sticky z-3 top-0 bg-white justify-between items-center pa3 bb b--light-silver br3 br--top f5 fw6 lh-title near-black",s),...r,children:t})},Pane=e=>{let{children:t,className:s="",forceScrollable:r=!1,...l}=e;return(0,n.jsx)("div",{className:i()(r?"overflow-y-scroll":"overflow-y-auto ","w-100",s),...l,children:t})}},12782:function(e,t,s){s.d(t,{XL:function(){return AuthorizeSlackLink},bC:function(){return RunQuotaMeter},VO:function(){return RunStatus},Zr:function(){return RunTime},QY:function(){return SchedulePane},bJ:function(){return firstOfNextMonth},Tl:function(){return minutesRemaining},DL:function(){return D},_u:function(){return useSlackUrl}});var n=s(85893),r=s(5379),i=s.n(r),l=s(80583),a=s(94184),c=s.n(a),d=s(19582),o=s(22828),u=s(66549),h=s(11163),x=s(67294),f=s(25273),j=s(26713),m=s(53141),b=s(15100);let Circle=e=>{let{...t}=e;return(0,n.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",...t,children:(0,n.jsx)("circle",{cx:"8",cy:"8",r:"4",stroke:"currentColor",strokeWidth:"2"})})};var g=s(71183),v=s(56065),p=s(42447),w=s(51337),k=s(93327),N=s(88903),y=s(17238),C=s(14255),M=s(5146),R=s(79998),S=s(63302),H=s(29020),L=s(4293),Z=s(38423),q=s(17616),V=s(60147);function useSlackUrl(e){let t=(0,h.useRouter)(),s=new URL(e?"/team/".concat(e.id,"/slack/oauth"):"/user/slack/oauth","https://api.observablehq.com");return s.searchParams.set("next",t.asPath),s.toString()}let AuthorizeSlackLink=e=>{let{context:t,label:s="Authorize Slack"}=e,r=useSlackUrl(t);return(0,n.jsx)(k.Z,{href:r,children:(0,n.jsxs)("a",{onClick:M.FN,className:"blue b--light-gray pointer animate-all hover-bg-black-05 f6 fw6 br2 ba flex items-center bg-transparent relative pa2 no-underline",children:[(0,n.jsx)(w.ZP,{className:"mr1"}),s]})})},_=new Map([["10m",o.rz.filter(e=>e.getMinutes()%10==2)],["1h",o.rz.filter(e=>50===e.getMinutes())],["1d",u.lM.filter(e=>11===e.getUTCHours())]]),D="https://observablehq.com/documentation/notebooks/schedules",RunTime=e=>{let{startTime:t,endTime:s,state:r}=e;return t&&s?(0,n.jsx)("div",{className:"truncate",children:(0,n.jsx)(C.q,{time:t,precision:"hour"})}):"pending"===r?(0,n.jsx)("span",{children:"Running…"}):(0,n.jsx)("span",{children:"".concat((0,R.fm)(r),"…")})},RunStatus=e=>{let{state:t,className:s}=e;return"success"===t?(0,n.jsx)(b.Z,{className:c()("green",s)}):"error"===t?(0,n.jsx)(g.Z,{width:16,height:16,className:c()(s)}):(0,n.jsx)(Circle,{className:c()("gold",s)})};function minutesRemaining(e,t){return Math.max(Math.floor(t-e),0)}let RunQuotaMeter=e=>{let{used:t,quota:s}=e;if(t>=s)return(0,n.jsx)(p.eA,{title:"No scheduler minutes remaining this month"});{let e=Math.floor((s-t)/s*100),r="".concat(minutesRemaining(t,s)," scheduler minutes remaining this month");return e>=95?(0,n.jsx)(p.i4,{title:r}):e>=75?(0,n.jsx)(p.Aw,{title:r}):e>=50?(0,n.jsx)(p.Xt,{title:r}):e>=25?(0,n.jsx)(p.fy,{title:r}):(0,n.jsx)(p.X7,{title:r})}};function firstOfNextMonth(){let e=new Date;return new Date(e.getFullYear(),11===e.getMonth()?0:e.getMonth()+1,1).toLocaleString("default",{month:"long",day:"numeric"})}let SchedulePane=()=>{let{id:e,owner:t,slug:s,schedule:r,usedClients:a,canEdit:o,isOwnerVisible:u}=(0,V.v9)(e=>{let{notebook:t}=e;return{id:t.id,owner:t.owner,slug:t.slug,schedule:t.schedule,usedClients:(0,Z.Z)(t.model.nodes).notificationClients,canEdit:(0,q.MD)(t),isOwnerVisible:!((0,H.p0)(t)&&(0,H.hv)(t))}}),{data:b,isLoading:p}=(0,M.h_)("/schedule/".concat(e,"/runs?desc=true&limit=10")),{data:w}=(0,M.h_)("team"===t.type?"/team/".concat(t.id,"/run-quota"):"/user/run-quota"),C=!!w&&w.used>=w.quota,P=o&&u,A=(0,V.I0)(),B=(0,h.useRouter)(),z=(0,d.Xx)([...a],e=>e.split(":")[0]).filter(e=>{let[t]=e;return"slack"===t||"email"===t}),[T,X]=(0,x.useState)(),O=z.map(e=>e[0]).includes("slack");return(0,x.useEffect)(()=>{async function checkSlack(){try{await (0,M.a8)("/team/".concat(t.id,"/token?provider=slackNotifications")),X(!0)}catch(e){X(!1)}}O&&checkSlack()},[t.id,O]),(0,n.jsxs)(y.X,{children:[(0,n.jsxs)(y.h,{children:["Schedule",w&&(0,n.jsxs)(l.v2,{children:[(0,n.jsx)(N.j2,{className:"bn bg-transparent pa0 pointer dn db-ns",children:(0,n.jsx)(RunQuotaMeter,{used:w.used,quota:w.quota})}),(0,n.jsxs)(l.YI,{className:"bg-white ph3 ba b--light-silver br2",style:{width:330},position:N.Ly.bottomLeft,children:[(0,n.jsxs)("p",{className:"jsx-d8ebe099786d56cf "+(c()({gold:C})||""),children:[minutesRemaining(w.used,w.quota)," scheduler minutes remaining this month"]}),C&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{className:"jsx-d8ebe099786d56cf",children:["All schedules are paused until your monthly quota renews on"," ",firstOfNextMonth()]}),(0,n.jsxs)("p",{className:"jsx-d8ebe099786d56cf",children:["Please"," ",(0,n.jsx)("a",{href:"mailto:support@observablehq.com",className:"jsx-d8ebe099786d56cf blue",children:"contact support"})," ","if you need a higher monthly quota."]})]}),(0,n.jsxs)("div",{className:"jsx-d8ebe099786d56cf flex justify-between mv3",children:[(0,n.jsx)("a",{href:D,className:"jsx-d8ebe099786d56cf no-underline",children:(0,n.jsx)(j.kq,{text:"Docs",icon:m.Z,iconPosition:"right"})}),(0,n.jsx)(j.KM,{text:"Settings",icon:m.Z,iconPosition:"right",onClick:()=>B.push("".concat((0,q.rF)(t),"/schedules"))})]})]})]})]}),(0,n.jsxs)("div",{className:"jsx-d8ebe099786d56cf pv3 dark-gray",children:[(0,n.jsxs)("div",{className:"jsx-d8ebe099786d56cf ph3",children:[(0,n.jsx)(f.P,{className:"w-100",value:r||"none",onChange:e=>{A({type:"setSchedule",schedule:"none"===e.target.value?null:e.target.value})},disabled:!P,children:[{schedule:"none",label:"None"},{schedule:"10m",label:"Run every 10 minutes"},{schedule:"1h",label:"Run every hour"},{schedule:"1d",label:"Run every day"}].map(e=>{let{schedule:t,label:s}=e;return(0,n.jsx)("option",{value:t,className:"jsx-d8ebe099786d56cf",children:s},t)})}),(0,n.jsx)("div",{className:"jsx-d8ebe099786d56cf flex justify-between gray f7 mt1",children:function(e){let{schedule:t,currentRun:s,isOwnerVisible:r,canEdit:i,overQuota:l}=e;if(!i)return"You cannot edit this notebook";if(!r)return"Scheduling is only permitted in non-private notebooks";if(l)return(0,n.jsx)("span",{className:"gold",children:"0 scheduler minutes remaining this month."});if(!t)return"No runs scheduled";if(s){let{state:e}=s;if("pending"===e||"queued"===e||"assigned"===e)return null}let a=new Date,c=_.get(t),d=c.floor(a),o=c.ceil(a),u=(null==s?void 0:s.end_time)&&+a-+s.end_time<6e4;return!u&&(+a-+d<6e4||+o-+a<6e4)?"Calculating next run…":"Next run ".concat((0,L.LU)(+a-+o))}({schedule:r,currentRun:null==b?void 0:b[0],isOwnerVisible:u,canEdit:o,overQuota:C})})]}),(null==b?void 0:b.length)?(0,n.jsxs)("div",{className:"jsx-d8ebe099786d56cf pt3",children:[(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"3.5fr 1fr 1fr",gap:16},className:"jsx-d8ebe099786d56cf ph3",children:["Run","Version","Result"].map(e=>(0,n.jsx)("div",{className:"jsx-d8ebe099786d56cf "+(c()("pv2 f7 fw6 ttu gray flex","Version"===e||"Result"===e?"justify-end":null)||""),children:e},e))}),p?(0,n.jsx)("div",{className:"jsx-d8ebe099786d56cf ph3",children:(0,n.jsx)(v.Z,{})}):b.map(r=>{let{id:i,start_time:l,end_time:a,state:c,document_version:d}=r;return(0,n.jsx)(k.Z,{href:(0,S.Bi)({id:e,slug:s,owner:t},void 0,void 0,"runs/".concat(i)),children:(0,n.jsx)("a",{target:"_blank",className:"jsx-d8ebe099786d56cf no-underline",children:(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"3.5fr 1fr 1fr",gap:16},className:"jsx-d8ebe099786d56cf pv2 ph3 run",children:[(0,n.jsx)(RunTime,{startTime:l,endTime:a,state:c}),(0,n.jsx)("div",{className:"jsx-d8ebe099786d56cf flex justify-end truncate",children:"v".concat(d)}),(0,n.jsx)("div",{className:"jsx-d8ebe099786d56cf flex justify-center",children:(0,n.jsx)(RunStatus,{state:c})})]})})},i)}),(0,n.jsx)("div",{className:"jsx-d8ebe099786d56cf pt2 ph3 flex justify-end",children:(0,n.jsx)(k.Z,{href:(0,S.Bi)({id:e,slug:s,owner:t},void 0,void 0,"runs"),children:(0,n.jsx)("a",{target:"_blank",className:"jsx-d8ebe099786d56cf no-underline blue",children:"All runs…"})})})]}):p?null:(0,n.jsxs)("div",{className:"jsx-d8ebe099786d56cf ph3 lh-copy",children:[(0,n.jsx)("p",{className:"jsx-d8ebe099786d56cf",children:"You can run your notebooks periodically on Observable’s servers to send Notifications and run other tasks. You’ll be able to access logs and errors from those runs for up to 30 days."})," ",(0,n.jsxs)("p",{className:"jsx-d8ebe099786d56cf mb0",children:["By scheduling your notebook, you consent to let Observable run your notebooks and store limited logs."," ",(0,n.jsx)("a",{href:D,className:"jsx-d8ebe099786d56cf blue",children:"Learn more…"})]})]}),z.length>0&&(0,n.jsxs)("div",{className:"jsx-d8ebe099786d56cf ph3 pt3 mt3 bt b--light-silver",children:[(0,n.jsx)("div",{className:"jsx-d8ebe099786d56cf f6 fw6 near-black",children:"Notifications"}),z.map((e,t)=>{let[s,r]=e,i=r.flatMap(e=>{var t;return null===(t=e.split(":")[1])||void 0===t?void 0:t.split(",")}).filter(e=>e).join(", ");return(0,n.jsxs)("div",{className:"jsx-d8ebe099786d56cf mt2 flex f7",children:[(0,n.jsx)("div",{className:"jsx-d8ebe099786d56cf fw5 w3 flex-shrink-0",children:(0,R.fm)(s)}),(0,n.jsx)("div",{title:i,className:"jsx-d8ebe099786d56cf gray truncate",children:i})]},t)}),!1===T&&P&&(0,n.jsx)("div",{className:"jsx-d8ebe099786d56cf mt3",children:(0,n.jsxs)("div",{className:"jsx-d8ebe099786d56cf flex items-center justify-between f7 red fw5",children:[(0,n.jsxs)("div",{className:"jsx-d8ebe099786d56cf flex items-center",children:[(0,n.jsx)(g.Z,{className:"flex-shrink-0 mr1"}),"Slack is not authorized"]}),(0,n.jsx)(AuthorizeSlackLink,{context:t,label:"Authorize"})]})})]})]}),(0,n.jsx)(i(),{id:"d8ebe099786d56cf",children:".run.jsx-d8ebe099786d56cf:not(:last-child){padding-bottom:var(--spacing-small)}.run.jsx-d8ebe099786d56cf:hover{background-color:var(--near-white)}"})]})}}}]);